---
  name: aggregate_des_nonewdata
  description: Aggregate data elements with no data values in the last 3 periods (based on data set period type).
  section: Data elements
  section_order: 5
  summary_uid: MuHwWvUxbxQ
  summary_sql: >-
    with ds_period as (select datasetid,dataelementid,
    periodid from dataset ds
    left join period pe using(periodtypeid)
    left join datasetelement using(datasetid)
    where date_part('day', now() - pe.enddate::timestamp)::int
    <= 3*date_part('day', pe.enddate::timestamp - pe.startdate::timestamp)::int)
    select 'dataelement_nonewdata', count(*)::varchar, (100*count(*)/(select count(*)
    from dataelement where domaintype = 'AGGREGATE' ))::varchar || '%',
    'Aggregate data elements with no data values in the last 3 periods (based on data set period type).'
    from dataelement where domaintype = 'AGGREGATE'
    and dataelementid not in (select distinct dataelementid from ds_period
    where (dataelementid,periodid) in (select dataelementid, periodid from datavalue) group by dataelementid);
  details_uid: W7GMsAf31cR
  details_sql: >-
    with ds_period as (select datasetid,dataelementid,
    periodid from dataset ds
    left join period pe using(periodtypeid)
    left join datasetelement using(datasetid)
    where date_part('day', now() - pe.enddate::timestamp)::int
    <= 3*date_part('day', pe.enddate::timestamp - pe.startdate::timestamp)::int)
    select uid,name from dataelement
    where domaintype = 'AGGREGATE'
    and dataelementid not in (select distinct dataelementid from ds_period
    where (dataelementid,periodid) in (select dataelementid, periodid from datavalue) group by dataelementid)
    ORDER BY name;